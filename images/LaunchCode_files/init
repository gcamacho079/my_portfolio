var Doorbell=function(){var options={},host=null,submitting=false,uploading=false,uploadedAttachments=[],uploadedPastedAttachments=[],pastedAttachments=[],isPostmessageIframeLoaded=false,properties={},screenshot='',screenshotData=null,npsRatingAllowed=false,generatingScreenshot=false,generatingScreenshotTime=0,submitAfterScreenshot=false,defaultStrings={'title':'Message LaunchCode','intro-text':'<div id="intro-text">If you have any questions, please check out our <a href=\"https:\/\/www.launchcode.org\/faq\">FAQ<\/a> .\r\n<br>\r\n<br>\r\n</div>','feedback-textarea-placeholder':'If you couldn\u0027t find what you looked for in FAQ, feel free to message us here.','feedback-label':'','attach-a-screenshot':'Attach a screenshot','email-input-placeholder':'Your email address','email-label':'','submit-button-text':'Send','submitting-button-text':'Sending...','uploading-button-text':'Uploading...','feedback-button-text':'Questions?','add-attachments-label':'','add-attachments-label-button':'Upload files','nps-rating-label':'How would you rate us?','nps-rating-bad-label':'Not that good','nps-rating-good-label':'Great','message-success':null,'message-error-missing-email':null,'message-error-invalid-email':null,'message-error-missing-message':null,'message-error-message-too-short':null},option=function(o){if(typeof options[o]!=='undefined'){return options[o];}else{return null;}},canUploadAttachments=function(){if(!supportAjaxUploadWithProgress()){return false;}
return false;},installed=function(){return!!1;},getString=function(s){var strings=option('strings');if(strings!==null&&typeof strings==='object'&&typeof strings[s]!=='undefined'){return strings[s];}
if(typeof defaultStrings[s]!=='undefined'){return defaultStrings[s];}
return null;},getAppId=function(){return'2942';},getAppKey=function(){return options.appKey;},disableButton=function(text){var button=el('doorbell-submit-button');if(!button.disabled){button.className+=' disabled';button.disabled=true;var currentText=button.innerHTML;button.setAttribute('data-original-text',currentText);}
if(typeof text!=='undefined'&&text.length>0){button.innerHTML=text;}},enableButton=function(){var button=el('doorbell-submit-button');button.className=button.className.replace('disabled','');button.disabled=false;button.innerHTML=button.getAttribute('data-original-text');},supportAjaxUploadWithProgress=function(){function supportFileAPI(){var fi=document.createElement('INPUT');fi.type='file';return'files'in fi;}
function supportAjaxUploadProgressEvents(){var xhr=new XMLHttpRequest();return!!(xhr&&('upload'in xhr)&&('onprogress'in xhr.upload));}
function supportFormData(){return!!window.FormData;}
try{return supportFileAPI()&&supportAjaxUploadProgressEvents()&&supportFormData();}catch(e){return false;}},canGenerateScreenshot=function(){return(typeof html2canvas==='function'||typeof getHTML==='function');},canSendScreenshot=function(){return(isPostmessageIframeLoaded||supportAjaxUploadWithProgress())&&canGenerateScreenshot()&&false;},showForm=function(){var onShowCallback=option('onShow');if(typeof onShowCallback==='function'){if(onShowCallback()===false){return;}}
openForm();var shouldGenerateScreenshot=true;var onGenerateScreenshotCallback=option('onGenerateScreenshot');if(typeof onGenerateScreenshotCallback==='function'){if(onGenerateScreenshotCallback()===false){shouldGenerateScreenshot=false;}}
if(canSendScreenshot()===true&&shouldGenerateScreenshot===true){try{if(typeof html2canvas==='function'){var proxy=host+'/html2canvasproxy.php';generatingScreenshot=true;generatingScreenshotTime=0;var screenshotStart=new Date().getTime();html2canvas([document.body],{proxy:proxy,async:true,logging:!!'',onrendered:function(canvas){generatingScreenshotTime=(new Date().getTime())-screenshotStart;screenshot=canvas.toDataURL();var onScreenshotGeneratedCallback=option('onScreenshotGenerated');if(typeof onScreenshotGeneratedCallback==='function'){onScreenshotGeneratedCallback(screenshot);}
generatingScreenshot=false;if(submitAfterScreenshot){submit();}}});}
initScreenshot();}catch(e){var attachScreenshotCheckboxWrapper=el('doorbell-attach-screenshot-wrapper');if(attachScreenshotCheckboxWrapper){attachScreenshotCheckboxWrapper.style.display='none';}}}},getScroll=function(){if(window.pageYOffset!=undefined){return[pageXOffset,pageYOffset];}else{var sx,sy,d=document,r=d.documentElement,b=d.body;sx=r.scrollLeft||b.scrollLeft||0;sy=r.scrollTop||b.scrollTop||0;return[sx,sy];}},getYScroll=function(){return getScroll()[1];},isInline=function(){return option('container')!==null;},isModal=function(){return!isInline();},openForm=function(){if(canSendScreenshot()===true&&typeof html2canvas==='function'){window.scroll(0,0);}
var emailField=el('doorbell-email');var emailLabel=el('doorbell-email-label');if(option('hideEmail')){emailField.style.display='none';if(emailLabel){emailLabel.style.display='none';}}else{emailField.style.display='block';if(emailLabel){emailLabel.style.display='block';}}
if(option('email')!==null){emailField.value=option('email');}
el('doorbell').style.display='block';if(isModal()){el('doorbell-background').style.display='block';el('doorbell').style.top=getYScroll()+100+'px';el('doorbell-feedback').focus();}
formOpened();var onShownCallback=option('onShown');if(typeof onShownCallback==='function'){onShownCallback();}},el=function(id){return document.getElementById(id);},hideForm=function(){if(el('doorbell').style.display==='none'){return;}
var onHideCallback=option('onHide');if(typeof onHideCallback==='function'){if(onHideCallback()===false){return;}}
var successContainer=getAlertBox('success');successContainer.style.display='none';var errorContainer=getAlertBox('error');errorContainer.style.display='none';if(isModal()){el('doorbell-background').style.display='none';}
el('doorbell').style.display='none';screenshot='';var onHiddenCallback=option('onHidden');if(typeof onHiddenCallback==='function'){onHiddenCallback();}},getSuccessMessage=function(defaultMessage){var successMessage=option('successMessage');if(successMessage){return successMessage;}
successMessage=getString('message-success');if(successMessage){return successMessage;}
return defaultMessage;},getErrorCode=function(error){if(typeof error==='string'){return null;}
if(typeof error==='object'){return error.type;}
return null;},getErrorMessage=function(error){if(typeof error==='string'){return error;}
if(typeof error==='object'){var errorType=error.type;var errorMessage=getString('message-error-'+errorType);if(errorMessage){return errorMessage;}}
return error.message;},showSuccessMessage=function(message){var successElement=getAlertBox('success');successElement.innerHTML=getSuccessMessage(message);successElement.style.display='block';setTimeout(function(){hideForm();},2000);},getEmail=function(){return el('doorbell-email').value;},getValuesOfExtraFormFields=function(input,textarea,select){var extraFields={};var formFields,formFieldCounter,field;var ignoreFields=['doorbell-feedback','doorbell-email'];var ignoreFieldsByName=['doorbell-nps-rating'];formFields=input;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];if(ignoreFields.indexOf(field.id)<0&&field.value.length>0&&field.name.length>0&&ignoreFieldsByName.indexOf(field.name)<0){if(field.type=='radio'||field.type=='checkbox'){if(field.checked){extraFields[field.name]=field.value;}}else if(field.type=='file'){}else{extraFields[field.name]=field.value;}}}
formFields=textarea;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];if(ignoreFields.indexOf(field.id)<0&&field.value.length>0&&field.name.length>0){extraFields[field.name]=field.value;}}
var selectValue;formFields=select;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];selectValue=field.options[field.selectedIndex].value;if(ignoreFields.indexOf(field.id)<0&&selectValue.length>0&&field.name.length>0){extraFields[field.name]=selectValue;}}
return extraFields;},isEmpty=function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))
return false;}
return true;},formHasFiles=function(form){if(!form){return false;}
var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){var input=inputs[i];if(input.type==='file'){if(input.files&&input.files.length>0){return true;}}}
return false;},clearFileInput=function(oldInput){try{var newInput=document.createElement("input");newInput.type="file";newInput.id=oldInput.id;newInput.className=oldInput.className;newInput.name=oldInput.name;newInput.multiple=oldInput.multiple;newInput.onchange=oldInput.onchange;oldInput.parentNode.replaceChild(newInput,oldInput);}catch(e){log(e);}},clearFileInputsInForm=function(form){if(!form){return false;}
var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){var input=inputs[i];if(input.type==='file'){if(input.files&&input.files.length>0){clearFileInput(input);}}}
return false;},resetAttachmentLabelButtonText=function(){if(!getString('add-attachments-label-button')){return;}
var label=el('doorbell-add-attachments-label-button');if(!label){return;}
label.innerHTML=getAttachmentLabelButtonText(getString('add-attachments-label-button'));},getNPSRating=function(){var radio=document.getElementsByClassName('doorbell-nps-rating');for(var i=0;i<radio.length;i++){if(radio[i].checked){return radio[i].value;}}
return 0;},submit=function(customMessage,customEmail,successCallback,errorCallback){var i;var onSubmitCallback=option('onSubmit');if(typeof onSubmitCallback==='function'){if(onSubmitCallback()===false){return;}}
if(submitting||uploading){return false;}
var errorContainer=getAlertBox('error');errorContainer.style.display='none';var uploadErrorCallback=function(text){uploading=false;errorContainer.style.display='block';errorContainer.innerHTML=text;enableButton();};var uploadForm=el('doorbell-form');if(uploadedAttachments.length===0&&uploadForm&&formHasFiles(uploadForm)){uploading=true;disableButton(getString('uploading-button-text'));if(uploadForm&&formHasFiles(uploadForm)){uploadFile(uploadForm,function(attachments){uploading=false;uploadedAttachments=attachments;submit(customMessage,customEmail,successCallback,errorCallback);},uploadErrorCallback);}
return false;}
if(uploadedPastedAttachments.length===0&&pastedAttachments.length>0){uploading=true;disableButton(getString('uploading-button-text'));if(pastedAttachments.length>0){for(i=0;i<pastedAttachments.length;i++){uploadPastedFile(pastedAttachments[i],function(attachments){uploading=false;uploadedPastedAttachments=attachments;submit(customMessage,customEmail,successCallback,errorCallback);},uploadErrorCallback);}}
return false;}
var wantToSendScreenshot=false;if(el('doorbell-attach-screenshot')&&el('doorbell-attach-screenshot').checked){wantToSendScreenshot=true;}
disableButton(getString('submitting-button-text'));if(wantToSendScreenshot&&generatingScreenshot){submitAfterScreenshot=true;return;}
submitAfterScreenshot=false;submitting=true;try{var screenResolution=screen.width+'x'+screen.height;addProperty('Screen resolution',screenResolution);}catch(e){}
try{var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName('body')[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight;var browserSize=x+'x'+y;addProperty('Browser size',browserSize);}catch(e){}
var feedback=el('doorbell-feedback').value;var email=getEmail();if(typeof customMessage!=='undefined'){feedback=customMessage;}
if(typeof customEmail!=='undefined'){email=customEmail;}
try{var form=el('doorbell-form');var extraFields;if(form){extraFields=getValuesOfExtraFormFields(form.getElementsByTagName('input'),form.getElementsByTagName('textarea'),form.getElementsByTagName('select'));if(!isEmpty(extraFields)){addProperty('Fields',extraFields);}}}catch(e){log('Failed to get extra properties from fields');}
var serializedProperties;try{serializedProperties=JSON.stringify(properties);}catch(e){log('Failed to serialize the properties');serializedProperties=properties;}
var data='message='+encodeURIComponent(feedback)+'&email='+encodeURIComponent(email)+'&properties='+encodeURIComponent(serializedProperties);var name=option('name');if(name!==null){data+='&name='+encodeURIComponent(name);}
var tags=option('tags');if(tags!==null){if(Object.prototype.toString.call(tags)==='[object Array]'){tags=tags.join(',');}
if(typeof tags==='string'){data+='&tags='+encodeURIComponent(tags);}}
if(uploadedAttachments.length>0){for(i=0;i<uploadedAttachments.length;i++){data+='&attachments[]='+encodeURIComponent(uploadedAttachments[i]);}}
if(uploadedPastedAttachments.length>0){for(i=0;i<uploadedPastedAttachments.length;i++){data+='&attachments[]='+encodeURIComponent(uploadedPastedAttachments[i]);}}
try{data+='&url='+encodeURIComponent(window.location.href);}catch(e){data+='&no_url=1';}
data+='&error_detail=1';try{var npsRating=getNPSRating();if(npsRatingAllowed&&npsRating>0){data+='&nps='+npsRating;}}catch(e){}
if(generatingScreenshotTime){data+='&screenshot_generation_time='+generatingScreenshotTime;}
ajax({url:host+'/api/applications/'+getAppId()+'/submit',data:data,success:function(data){el('doorbell-feedback').value='';clearFileInputsInForm(form);uploadedAttachments=[];pastedAttachments=[];uploadedPastedAttachments=[];refreshAttachmentsLabel();clearNPSRatingFields();var onSuccessCallback=option('onSuccess');if(typeof onSuccessCallback==='function'){onSuccessCallback();}
if(typeof successCallback==='function'){successCallback(data);}
showSuccessMessage(data);},error:function(error){var errorMessage=getErrorMessage(error);errorContainer.innerHTML=errorMessage;errorContainer.style.display='block';var errorCode=getErrorCode(error);if(errorCode==='invalid-email'||errorCode==='missing-email'){var emailField=el('doorbell-email');if(emailField){emailField.style.display='block';}}
var onErrorCallback=option('onError');if(typeof onErrorCallback==='function'){onErrorCallback(errorCode,errorMessage);}
if(typeof errorCallback==='function'){errorCallback(errorMessage);}},complete:function(){submitting=false;enableButton();}});},clearNPSRatingFields=function(){var radio=document.getElementsByClassName('doorbell-nps-rating');for(var i=0;i<radio.length;i++){if(radio[i].checked){radio[i].checked=false;}}},isElementVisible=function(el){if(!el.getClientRects){return fallbackIsElementVisible(el);}
try{return!!(el.offsetWidth||el.offsetHeight||el.getClientRects().length);}catch(e){return fallbackIsElementVisible(el);}},fallbackIsElementVisible=function(el){var style=window.getComputedStyle(el);return!(style.display==='none')},formOpened=function(){var poweredByLink=el('doorbell-powered-by');var visible='0';if(poweredByLink&&isElementVisible(poweredByLink)){visible='1';}
ajax({url:host+'/api/applications/'+getAppId()+'/open',data:'powered-by-link-visible='+visible,success:function(data){},error:function(error){}});},ping=function(){if(installed()){return;}
ajax({url:host+'/api/applications/'+getAppId()+'/ping',success:function(data){},error:function(error){}});},log=function(message){if(typeof console!=='undefined'&&typeof console.log!=='undefined'){console.log(message);}},addProperty=function(name,value){properties[name]=value;},getAuthParams=function(){var params='key='+getAppKey()+'&library=javascript';var timestamp=option('timestamp');if(timestamp){params+='&timestamp='+timestamp;}
var token=option('token');if(token){params+='&token='+token;}
var signature=option('signature');if(signature){params+='&signature='+signature;}
return params;},ajax=function(params){if(typeof params.data==='undefined'){params.data='';}
if(params.data.length>0){params.data+='&';}
params.data+=getAuthParams();var sendScreenshot=false;if(el('doorbell-attach-screenshot')&&el('doorbell-attach-screenshot').checked&&(screenshot.length>0||screenshotData!==null)){sendScreenshot=true;}
if(sendScreenshot&&(supportAjaxUploadWithProgress()||isPostmessageIframeLoaded)){if(screenshotData!==null){params.data+='&screenshot_data[screen_resolution][width]='+screen.width;params.data+='&screenshot_data[screen_resolution][height]='+screen.height;params.data+='&screenshot_data[viewport][width]='+screenshotData.viewport.width;params.data+='&screenshot_data[viewport][height]='+screenshotData.viewport.height;params.data+='&screenshot_data[pagesize][width]='+screenshotData.pagesize.width;params.data+='&screenshot_data[pagesize][height]='+screenshotData.pagesize.height;params.data+='&screenshot_data[scrollposition][top]='+screenshotData.scrollposition.top;params.data+='&screenshot_data[scrollposition][left]='+screenshotData.scrollposition.left;params.data+='&screenshot_data[html]='+encodeURIComponent(screenshotData.html);}else{params.data+='&screenshot='+screenshot;}}
if(supportAjaxUploadWithProgress()){makeCorsCall(params);}else if(isPostmessageIframeLoaded){params.referrer=window.location.href;makePostmessageCall(params);}else{makeJsonpCall(params);}},ajaxCallback=function(data,code,params){if(code>=200&&code<300){if(typeof params.success!=='undefined'){params.success(data);}}else{if(typeof params.error!=='undefined'){params.error(data);}}
if(typeof params.complete!=='undefined'){params.complete(data);}
if(typeof params.callback!=='undefined'){var callback=params.callback;var scriptTag=el('doorbell-'+callback);if(scriptTag){removeElement('doorbell-'+callback);try{delete window[callback];}catch(e){window[callback]=undefined;}}}},makeCorsCall=function(params){var xhr=new XMLHttpRequest();xhr.open('POST',params.url,true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){ajaxCallback(e,500,params);return;}
if(readyState==4){if(status>=200&&status<300&&text){ajaxCallback(text,status,params);}else{var data;try{data=JSON.parse(text);}catch(e){data=text;}
ajaxCallback(data,status,params);}}};xhr.send(params.data);},makePostmessageCall=function(params){var callback='jsonp'+(new Date().getTime());params.callback=callback;window[callback]=function(response){ajaxCallback(response.data,response.code,params);};if(typeof doorbellpm!=='undefined'){doorbellpm({target:window.frames["doorbellIframe"],type:"doorbellSend",data:params});}},makeJsonpCall=function(params){var callback='jsonp'+(new Date().getTime());params.callback=callback;if(typeof params.data==='undefined'){params.data='';}
if(params.data!=''){params.data+='&';}
params.data+='callback='+params.callback;window[callback]=function(response){ajaxCallback(response.data,response.code,params);};var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.id='doorbell-'+callback;script.src=params.url+'?'+params.data;script.onerror=function(){removeElement('doorbell-'+callback);log('Error loading JSONP script: '+script.src);};head.appendChild(script);},refreshAttachmentsLabel=function(){var fileInput=el('doorbell-add-attachments');var label=el('doorbell-add-attachments-label-button');if(label){var fileName='';try{var fileCount=0;if(fileInput.files&&fileInput.files.length>0){fileCount+=fileInput.files.length;}
fileCount+=pastedAttachments.length;var fileString='files';if(fileCount==1){fileString='file';}
if(fileCount>0){fileName=fileCount+' '+fileString+' selected';}}catch(ex){log(ex);}
if(fileName){label.innerHTML=getAttachmentLabelButtonText(fileName);}else{resetAttachmentLabelButtonText();}}},uploadFile=function(form,successCallback,errorCallback){var xhr=new XMLHttpRequest();xhr.open('POST',host+'/api/applications/'+getAppId()+'/upload?'+getAuthParams(),true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){errorCallback(e);return;}
if(readyState==4){if(status>=200&&status<300&&xhr.responseText){var data;try{data=JSON.parse(xhr.responseText);}catch(e){data=xhr.responseText;}
successCallback(data);}else{if((status==0||status==413)&&!text){text='Attachment too big';}
errorCallback(text);}}};var formData=new FormData(form);xhr.send(formData);},uploadPastedFile=function(result,successCallback,errorCallback){var xhr=new XMLHttpRequest();xhr.open('POST',host+'/api/applications/'+getAppId()+'/upload?'+getAuthParams(),true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){errorCallback(e);return;}
if(readyState==4){if(status>=200&&status<300&&xhr.responseText){var data;try{data=JSON.parse(xhr.responseText);}catch(e){data=xhr.responseText;}
successCallback(data);}else{if((status==0||status==413)&&!text){text='Attachment too big';}
errorCallback(text);}}};var formData=new FormData();var blob=result.file;var name=result.name?result.name:'image.'+blob.type.split('/')[1];formData.append('file',blob,name);xhr.send(formData);},getAlertBox=function(type){var alert=el('doorbell-'+type);if(alert){return alert;}
alert=document.createElement('div');if(type==='success'){alert.id='doorbell-success';alert.className='alert alert-success';}else if(type==='error'){alert.id='doorbell-error';alert.className='alert alert-error alert-danger';}else{return;}
var doorbellContainer=el('doorbell-container');var fieldset=doorbellContainer.getElementsByTagName('fieldset')[0];var legend=doorbellContainer.getElementsByTagName('legend')[0];fieldset.insertBefore(alert,legend);return alert;},getAttachmentLabelButtonText=function(text){return'<span><img src="https://embed.doorbell.io/img/paperclip.png" />'+text+'</span>';},removeElement=function(id){var removeEl=el(id);if(removeEl){try{removeEl.parentNode.removeChild(removeEl);}catch(e){}}},removeDoorbell=function(){removeElement('doorbell-button');removeElement('doorbell-background');removeElement('doorbell');},initScreenshot=function(){if(typeof htmlEditor==='undefined'||typeof getHTML!=='function'){return;}
screenshotData={viewport:htmlEditor.viewport_size(),pagesize:htmlEditor.page_size(),scrollposition:htmlEditor.window_scroll_position(),html:getHTML()};};if('Blob'in window&&'FormData'in window&&canUploadAttachments()){function addPasteImageReaderListener(callback){var options={matchType:/image.*/};if('addEventListener'in window){document.getElementsByTagName('html')[0].addEventListener('paste',function(event){try{if(document.getElementById('doorbell').style.display==='none'){return;}
var element=this;var clipboardData=event.clipboardData;if(!clipboardData){clipboardData=event.originalEvent.clipboardData;}
if(!clipboardData.items){return;}
var hasFiles=false;Array.prototype.forEach.call(clipboardData.types,function(type,i){if(type.match(options.matchType)||clipboardData.items[i].type.match(options.matchType)){var file=clipboardData.items[i].getAsFile();callback.call(element,{file:file,name:file.name});hasFiles=true;}});if(hasFiles){event.stopPropagation();event.preventDefault();}}catch(e){}});}}
addPasteImageReaderListener(function(result){pastedAttachments.push(result);refreshAttachmentsLabel();});}
if(typeof JSON!=='object'){JSON={};}
(function(){'use strict';function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());return{init:function(opts){options=opts;var onLoadCallback=option('onLoad');if(typeof onLoadCallback==='function'){onLoadCallback();}
host='https://doorbell.io';var hideButton=option('hideButton');if((hideButton===null||hideButton===false)&&isModal()){var button=document.createElement('button');button.id='doorbell-button';button.onclick=showForm;button.style.visibility='hidden';button.innerHTML=getString('feedback-button-text');document.body.appendChild(button);}
var head=document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0];var stylesheet=document.createElement('link');stylesheet.href='https://embed.doorbell.io/css/doorbell.min.css?v=1484753966';stylesheet.rel='stylesheet';stylesheet.type='text/css';stylesheet.id='doorbell-css-document';if(!el(stylesheet.id)){head.insertBefore(stylesheet,head.firstChild);}
var initProperties=option('properties');if(typeof initProperties==='object'&&initProperties!==null){properties=initProperties;}
var emailLabel=getString('email-label');if(emailLabel){emailLabel='<label for="doorbell-email" id="doorbell-email-label">'+emailLabel+'</label>';}
var emailField=emailLabel+'<input type="email" id="doorbell-email" class="form-control" placeholder="'+getString('email-input-placeholder')+'" value="" />';if(typeof doorbellpm!=='undefined'){doorbellpm.bind("doorbellIframeloaded",function(){isPostmessageIframeLoaded=true;return true;});doorbellpm.bind("doorbellSuccess",function(data){window[data.callback](data);return true;});doorbellpm.bind("doorbellError",function(data){window[data.callback](data);return true;});}
var npsRating='';if(npsRatingAllowed){npsRating='<label>'+getString('nps-rating-label')+'</label>';npsRating+='<div style="clear: both;">';for(var iNPS=0;iNPS<10;iNPS++){npsRating+='<p style="float: left; width: 10%; margin: 0; text-align: center;">';npsRating+='<input class="doorbell-nps-rating" type="radio" name="doorbell-nps-rating" value="'+(iNPS+1)+'" />';npsRating+='</p>';}
npsRating+='</div>';npsRating+='<p style="clear: both;">';npsRating+='<span style="float: left;">'+getString('nps-rating-bad-label')+'</span>';npsRating+='<span style="float: right;">'+getString('nps-rating-good-label')+'</span>';npsRating+='<span style="clear: both; height: 1px; display: block;"></span>';npsRating+='</p>';}
var feedbackLabel=getString('feedback-label');if(feedbackLabel){feedbackLabel='<label for="doorbell-feedback" id="doorbell-feedback-label">'+feedbackLabel+'</label>';}
var postMessageIframe='';var attachScreenshotCheckbox;if(canSendScreenshot()===true){if(!supportAjaxUploadWithProgress()){postMessageIframe='<iframe name="doorbellIframe" id="doorbellIframe" src="'+host+'/api/form?t=1485794217'+'" style="display: none!important;"></iframe>';}
attachScreenshotCheckbox='<div class="checkbox" id="doorbell-attach-screenshot-wrapper"><label><input type="checkbox" id="doorbell-attach-screenshot" value="1" /> '+getString('attach-a-screenshot')+'</label></div>';}else{attachScreenshotCheckbox='';}
var attachFiles='';if(canUploadAttachments()){var addAttachmentLabel=getString('add-attachments-label');if(addAttachmentLabel){addAttachmentLabel='<label for="doorbell-add-attachments" id="doorbell-add-attachments-label">'+addAttachmentLabel+'</label>';}else{addAttachmentLabel='';}
var addAttachmentLabelButton='';if(getString('add-attachments-label-button')){addAttachmentLabelButton='<label id="doorbell-add-attachments-label-button" for="doorbell-add-attachments">'+getAttachmentLabelButtonText(getString('add-attachments-label-button'))+'</label>';}
var attachmentInput='<input id="doorbell-add-attachments" class="'+(addAttachmentLabelButton?'has-label-button':'')+'" name="files[]" type="file" multiple="multiple" />';attachFiles=addAttachmentLabel+addAttachmentLabelButton+attachmentInput;}
var formHtml='<div id="doorbell-container"><button id="doorbell-close" title="Close" class="close">&times;</button><form id="doorbell-form" class="">        <fieldset>            <legend>'+getString('title')+'</legend>            '+getString('intro-text')+'            '+feedbackLabel+'            <textarea placeholder="'+getString('feedback-textarea-placeholder')+'" class="form-control" id="doorbell-feedback"></textarea>            '+emailField+'            '+attachFiles+'            '+attachScreenshotCheckbox+'            '+npsRating+'            <div class="buttons"><button class="btn btn-primary" id="doorbell-submit-button">'+getString('submit-button-text')+'</button></div>        </fieldset>                '+postMessageIframe+'    </form></div>';if(isModal()){var background=document.createElement('div');background.id='doorbell-background';background.className='';background.style.display='none';document.body.appendChild(background);background.onclick=function(e){var evt=(e)?e:window.event;if(evt!=null&&evt.target!=null&&evt.target.id=='doorbell-background'){hideForm();}};}
var container=document.createElement('div');container.id='doorbell';container.innerHTML=formHtml;container.style.display='none';if(isModal()){document.body.appendChild(container);el('doorbell-close').onclick=function(){hideForm();};}else{var inlineContainer=option('container');container.className='doorbell-inline';inlineContainer.appendChild(container);}
var doorbellForm=el('doorbell-form');doorbellForm.onsubmit=function(){submit();return false;};var doorbellInputs=doorbellForm.getElementsByTagName('input');for(var i=0;i<doorbellInputs.length;i++){var input=doorbellInputs[i];if(input.type==='file'){input.onchange=function(e){uploadedAttachments=[];refreshAttachmentsLabel();}}}
el('doorbell-feedback').onkeydown=function(e){var evt=(e)?e:window.event;if((evt.ctrlKey||evt.metaKey)&&evt.keyCode==13){submit();evt.preventDefault();evt.stopPropagation();return false;}};document.onkeydown=function(evt){evt=evt||window.event;if(evt.keyCode==27){hideForm();}};var onInitialized=option('onInitialized');if(typeof onInitialized==='function'){onInitialized();}
ping();if(isInline()){showForm();}},getProperty:function(name){if(typeof properties[name]!=='undefined'){return properties[name];}else{return null;}},setProperty:function(name,value){addProperty(name,value);},getOption:function(o){return option(o);},setOption:function(option,value){options[option]=value;},setName:function(newName){options.name=newName;},show:function(){showForm();},hide:function(){hideForm();},send:function(message,email,successCallback,errorCallback){submit(message,email,successCallback,errorCallback);},remove:function(){removeDoorbell();},refresh:function(){removeDoorbell();this.init(options);}};};var NO_JQUERY={};(function(window,$,undefined){if(!("console"in window)){var c=window.console={};c.log=c.warn=c.error=c.debug=function(){};}
if($===NO_JQUERY){$={fn:{},extend:function(){var a=arguments[0];for(var i=1,len=arguments.length;i<len;i++){var b=arguments[i];for(var prop in b){a[prop]=b[prop];}}
return a;}};}
$.fn.pm=function(){console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this;};$.pm=window.doorbellpm=function(options){doorbellpm.send(options);};$.pm.bind=window.doorbellpm.bind=function(type,fn,origin,hash){doorbellpm.bind(type,fn,origin,hash);};$.pm.unbind=window.doorbellpm.unbind=function(type,fn){doorbellpm.unbind(type,fn);};$.pm.origin=window.doorbellpm.origin=null;$.pm.poll=window.doorbellpm.poll=200;var doorbellpm={send:function(options){var o=$.extend({},doorbellpm.defaults,options),target=o.target;if(!o.target){console.warn("postmessage target window required");return;}
if(!o.type){return;}
var msg={data:o.data,type:o.type};if(o.success){msg.callback=doorbellpm._callback(o.success);}
if(o.error){msg.errback=doorbellpm._callback(o.error);}
if(("postMessage"in target)&&!o.hash){doorbellpm._bind();target.postMessage(JSON.stringify(msg),o.origin||'*');}
else{doorbellpm.hash._bind();doorbellpm.hash.send(o,msg);}},bind:function(type,fn,origin,hash){if(("postMessage"in window)&&!hash){doorbellpm._bind();}
else{doorbellpm.hash._bind();}
var l=doorbellpm.data("listeners.postmessage");if(!l){l={};doorbellpm.data("listeners.postmessage",l);}
var fns=l[type];if(!fns){fns=[];l[type]=fns;}
fns.push({fn:fn,origin:origin||$.pm.origin});},unbind:function(type,fn){var l=doorbellpm.data("listeners.postmessage");if(l){if(type){if(fn){var fns=l[type];if(fns){var m=[];for(var i=0,len=fns.length;i<len;i++){var o=fns[i];if(o.fn!==fn){m.push(o);}}
l[type]=m;}}
else{delete l[type];}}
else{for(var i in l){delete l[i];}}}},data:function(k,v){if(v===undefined){return doorbellpm._data[k];}
doorbellpm._data[k]=v;return v;},_data:{},_CHARS:'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),_random:function(){var r=[];for(var i=0;i<32;i++){r[i]=doorbellpm._CHARS[0|Math.random()*32];};return r.join("");},_callback:function(fn){var cbs=doorbellpm.data("callbacks.postmessage");if(!cbs){cbs={};doorbellpm.data("callbacks.postmessage",cbs);}
var r=doorbellpm._random();cbs[r]=fn;return r;},_bind:function(){if(!doorbellpm.data("listening.postmessage")){if(window.addEventListener){window.addEventListener("message",doorbellpm._dispatch,false);}
else if(window.attachEvent){window.attachEvent("onmessage",doorbellpm._dispatch);}
doorbellpm.data("listening.postmessage",1);}},_dispatch:function(e){try{var msg=JSON.parse(e.data);}
catch(ex){return;}
if(!msg.type){return;}
var cbs=doorbellpm.data("callbacks.postmessage")||{},cb=cbs[msg.type];if(cb){cb(msg.data);}
else{var l=doorbellpm.data("listeners.postmessage")||{};var fns=l[msg.type]||[];for(var i=0,len=fns.length;i<len;i++){var o=fns[i];if(o.origin&&e.origin!==o.origin){console.warn("postmessage message origin mismatch",e.origin,o.origin);if(msg.errback){var error={message:"postmessage origin mismatch",origin:[e.origin,o.origin]};doorbellpm.send({target:e.source,data:error,type:msg.errback});}
continue;}
try{var r=o.fn(msg.data);if(msg.callback){doorbellpm.send({target:e.source,data:r,type:msg.callback});}}
catch(ex){if(msg.errback){doorbellpm.send({target:e.source,data:ex,type:msg.errback});}}};}}};doorbellpm.hash={send:function(options,msg){var target_window=options.target,target_url=options.url;if(!target_url){console.warn("postmessage target window url is required");return;}
target_url=doorbellpm.hash._url(target_url);var source_window,source_url=doorbellpm.hash._url(window.location.href);if(window==target_window.parent){source_window="parent";}
else{try{for(var i=0,len=parent.frames.length;i<len;i++){var f=parent.frames[i];if(f==window){source_window=i;break;}};}
catch(ex){source_window=window.name;}}
if(source_window==null){console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list");return;}
var hashmessage={"x-requested-with":"postmessage",source:{name:source_window,url:source_url},postmessage:msg};var hash_id="#x-postmessage-id="+doorbellpm._random();target_window.location=target_url+hash_id+encodeURIComponent(JSON.stringify(hashmessage));},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:"#x-postmessage-id=".length+32,_bind:function(){if(!doorbellpm.data("polling.postmessage")){setInterval(function(){var hash=""+window.location.hash,m=doorbellpm.hash._regex.exec(hash);if(m){var id=m[1];if(doorbellpm.hash._last!==id){doorbellpm.hash._last=id;doorbellpm.hash._dispatch(hash.substring(doorbellpm.hash._regex_len));}}},$.pm.poll||200);doorbellpm.data("polling.postmessage",1);}},_dispatch:function(hash){if(!hash){return;}
try{hash=JSON.parse(decodeURIComponent(hash));if(!(hash['x-requested-with']==='postmessage'&&hash.source&&hash.source.name!=null&&hash.source.url&&hash.postmessage)){return;}}
catch(ex){return;}
var msg=hash.postmessage,cbs=doorbellpm.data("callbacks.postmessage")||{},cb=cbs[msg.type];if(cb){cb(msg.data);}
else{var source_window;if(hash.source.name==="parent"){source_window=window.parent;}
else{source_window=window.frames[hash.source.name];}
var l=doorbellpm.data("listeners.postmessage")||{};var fns=l[msg.type]||[];for(var i=0,len=fns.length;i<len;i++){var o=fns[i];if(o.origin){var origin=/https?\:\/\/[^\/]*/.exec(hash.source.url)[0];if(origin!==o.origin){console.warn("postmessage message origin mismatch",origin,o.origin);if(msg.errback){var error={message:"postmessage origin mismatch",origin:[origin,o.origin]};doorbellpm.send({target:source_window,data:error,type:msg.errback,hash:true,url:hash.source.url});}
continue;}}
try{var r=o.fn(msg.data);if(msg.callback){doorbellpm.send({target:source_window,data:r,type:msg.callback,hash:true,url:hash.source.url});}}
catch(ex){if(msg.errback){doorbellpm.send({target:source_window,data:ex,type:msg.errback,hash:true,url:hash.source.url});}}};}},_url:function(url){return(""+url).replace(/#.*$/,"");}};$.extend(doorbellpm,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:false}});})(this,typeof jQuery==="undefined"?NO_JQUERY:jQuery);if(typeof window.html2canvas==='undefined'){}
(function(){var doorbellOptionsVarName='doorbellOptions';var doorbellOptionsVarNameOverride='';if(doorbellOptionsVarNameOverride.length>0){doorbellOptionsVarName=doorbellOptionsVarNameOverride;}
var doorbellObjectName='doorbell';var doorbellObjectNameOverride='';if(doorbellObjectNameOverride.length>0){doorbellObjectName=doorbellObjectNameOverride;}
var options;if(typeof window[doorbellOptionsVarName]==='undefined'){return;}else if(typeof window[doorbellOptionsVarName].appKey==='undefined'){return;}else{options=window.doorbellOptions;}
window[doorbellObjectName]=new Doorbell();window[doorbellObjectName].init(options);})();